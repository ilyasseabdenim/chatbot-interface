<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatBot Interface</title>
    <script src="https://cdn.auth0.com/js/auth0-spa-js/2.0/auth0-spa-js.production.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <!-- Login Screen -->
    <div id="login-container" class="min-h-screen flex items-center justify-center">
        <div class="bg-white p-8 rounded-lg shadow-lg max-w-sm w-full">
            <h1 class="text-2xl font-bold text-center mb-6">Welcome to ChatBot</h1>
            <button id="login-btn" class="w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700">
                Sign In
            </button>
        </div>
    </div>

    <!-- Chat Screen -->
    <div id="chat-container" class="hidden min-h-screen">
        <!-- Header -->
        <div class="bg-white shadow">
            <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <h1 class="text-xl font-bold">ChatBot</h1>
                    <span id="user-email" class="text-gray-600"></span>
                </div>
                <button id="logout-btn" class="text-gray-600 hover:text-gray-800">Sign Out</button>
            </div>
        </div>

        <!-- Chat Area -->
        <div class="max-w-3xl mx-auto p-4">
            <div class="bg-white rounded-lg shadow">
                <!-- Messages -->
                <div id="chat-box" class="h-[500px] overflow-y-auto p-4"></div>

                <!-- Input -->
                <div class="border-t p-4">
                    <div class="flex gap-2">
                        <input type="text" 
                               id="user-input" 
                               class="flex-1 border rounded-full px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" 
                               placeholder="Type a message...">
                        <button id="send-btn" 
                                class="bg-blue-600 text-white px-6 py-2 rounded-full hover:bg-blue-700">
                            Send
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Auth0 Configuration
        let auth0Client = null;

        // Initialize Auth0
        async function initAuth0() {
            try {
                auth0Client = await auth0.createAuth0Client({
                    domain: 'dev-mz8c8fsonw81ep0j.us.auth0.com',
                    client_id: 'FPVfw1307EHppIuL8elWrE6KcBzS8Ubq',
                    redirect_uri: 'http://marvelous-peony-38d739.netlify.app'
                });

                // Handle callback
                if (window.location.search.includes("code=")) {
                    await auth0Client.handleRedirectCallback();
                    window.history.replaceState({}, document.title, window.location.origin);
                }

                const isAuthenticated = await auth0Client.isAuthenticated();
                if (isAuthenticated) {
                    const user = await auth0Client.getUser();
                    showChatInterface(user);
                } else {
                    showLoginScreen();
                }
            } catch (error) {
                console.error('Auth0 Error:', error);
            }
        }

        // Show/Hide Functions
        function showLoginScreen() {
            document.getElementById('login-container').style.display = 'flex';
            document.getElementById('chat-container').style.display = 'none';
        }

        function showChatInterface(user) {
            document.getElementById('login-container').style.display = 'none';
            document.getElementById('chat-container').style.display = 'block';
            document.getElementById('user-email').textContent = user.email;
            document.getElementById('user-input').disabled = false;
            document.getElementById('send-btn').disabled = false;
        }

        // Message Functions
        function addMessage(text, isUser = true) {
            const chatBox = document.getElementById('chat-box');
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex mb-4 ${isUser ? 'justify-end' : 'justify-start'}`;
            
            const bubble = document.createElement('div');
            bubble.className = `max-w-xs rounded-lg p-3 ${
                isUser ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-800'
            }`;
            bubble.textContent = text;
            
            messageDiv.appendChild(bubble);
            chatBox.appendChild(messageDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        // Event Listeners
        document.getElementById('login-btn').addEventListener('click', () => {
            auth0Client.loginWithRedirect();
        });

        document.getElementById('logout-btn').addEventListener('click', () => {
            auth0Client.logout({
                returnTo: window.location.origin
            });
        });

        document.getElementById('send-btn').addEventListener('click', handleSendMessage);
        document.getElementById('user-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleSendMessage();
        });

        function handleSendMessage() {
            const input = document.getElementById('user-input');
            const message = input.value.trim();
            
            if (message) {
                addMessage(message, true);
                input.value = '';
                
                // Bot response (you can replace this with your API call)
                setTimeout(() => {
                    addMessage('I received your message: ' + message, false);
                }, 1000);
            }
        }

        // Initialize when page loads
        window.onload = initAuth0;
    </script>
</body>
</html>
