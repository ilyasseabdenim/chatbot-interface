<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Chatbot Interface</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.auth0.com/js/auth0-spa-js/2.0/auth0-spa-js.production.js"></script>
    <style>
        .chat-container { max-height: 80vh; }
        .chat-bubble-bot { background-color: #eef2ff; color: #312e81; }
        .chat-bubble-user { background-color: #1e40af; color: #ffffff; }
        .option-btn { cursor: pointer; }
        .form-container-in-chat {
            background-color: white;
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid #e2e8f0;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body class="bg-slate-100 min-h-screen">
    <!-- Login Container -->
    <div id="login-container" class="flex items-center justify-center min-h-screen">
        <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-md">
            <div class="text-center mb-8">
                <div class="inline-flex items-center bg-indigo-100 text-indigo-700 py-2 px-4 rounded-full mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M2 5a2 2 0 012-2h7a2 2 0 012 2v4a2 2 0 01-2 2H9l-3 3v-3H4a2 2 0 01-2-2V5z"/>
                        <path d="M15 7v2a4 4 0 01-4 4H9.828l-1.766 1.767c.28.149.599.233.938.233h2l3 3v-3h2a2 2 0 002-2V9a2 2 0 00-2-2h-1z"/>
                    </svg>
                    <h1 class="text-2xl font-bold tracking-tight">ChatBot <span class="text-indigo-600">Interface</span></h1>
                </div>
                <h2 class="text-xl font-semibold text-slate-800">Welcome!</h2>
                <p class="text-slate-600 mt-1">Please sign in to continue</p>
            </div>
            <button id="login-btn" class="w-full bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                Sign In
            </button>
        </div>
    </div>

    <!-- Chat Container -->
    <div id="chat-container" class="hidden">
        <!-- Header -->
        <div class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <h1 class="text-xl font-semibold text-slate-800">ChatBot Interface</h1>
                    <span id="user-email" class="text-sm text-slate-500"></span>
                </div>
                <button id="logout-btn" class="text-slate-600 hover:text-slate-800">
                    Sign Out
                </button>
            </div>
        </div>

        <!-- Chat Interface -->
        <div class="max-w-3xl mx-auto p-4">
            <div class="bg-white rounded-2xl shadow-xl">
                <div class="p-4 border-b bg-blue-900 text-white rounded-t-2xl">
                    <h2 class="text-xl font-bold">Chat with our Bot</h2>
                </div>
                <div id="chat-box" class="flex-1 p-6 overflow-y-auto chat-container min-h-[400px]"></div>
                <div id="input-area" class="p-4 border-t bg-slate-50 rounded-b-2xl">
                    <div class="flex gap-2">
                        <input type="text" id="user-input" class="flex-1 px-4 py-2 border rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Type a message..." disabled>
                        <button id="send-btn" class="px-6 py-2 bg-blue-600 text-white rounded-full hover:bg-blue-700 disabled:bg-slate-400" disabled>Send</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let auth0Client = null;
        const configureClient = async () => {
            auth0Client = await auth0.createAuth0Client({
                domain: 'YOUR_AUTH0_DOMAIN',
                client_id: 'YOUR_CLIENT_ID',
                redirect_uri: window.location.origin
            });
        };

        // Handle user authentication
        window.onload = async () => {
            await configureClient();
            
            // Check for the code in the URL
            const query = window.location.search;
            if (query.includes("code=")) {
                await auth0Client.handleRedirectCallback();
                window.history.replaceState({}, document.title, "/");
            }

            const isAuthenticated = await auth0Client.isAuthenticated();
            if (isAuthenticated) {
                showChatInterface();
            } else {
                showLoginContainer();
            }
        };

        // UI update functions
        const showLoginContainer = () => {
            document.getElementById('login-container').classList.remove('hidden');
            document.getElementById('chat-container').classList.add('hidden');
        };

        const showChatInterface = async () => {
            const user = await auth0Client.getUser();
            document.getElementById('user-email').textContent = user.email;
            document.getElementById('login-container').classList.add('hidden');
            document.getElementById('chat-container').classList.remove('hidden');
            initializeChatbot();
        };

        // Event Listeners
        document.getElementById('login-btn').addEventListener('click', () => {
            auth0Client.loginWithRedirect();
        });

        document.getElementById('logout-btn').addEventListener('click', () => {
            auth0Client.logout({
                returnTo: window.location.origin
            });
        });

        // Initialize your existing chatbot code
        function initializeChatbot() {
            // Your existing chatbot initialization code goes here
            const chatBox = document.getElementById('chat-box');
            const userInput = document.getElementById('user-input');
            const sendBtn = document.getElementById('send-btn');

            // Enable input
            userInput.disabled = false;
            sendBtn.disabled = false;

            // Add welcome message
            addMessage("Hello! How can I help you today?", 'bot');
        }

        // Chat functionality
        function addMessage(message, sender) {
            const bubble = document.createElement('div');
            const messageWrapper = document.createElement('div');
            messageWrapper.className = 'mb-4 flex ' + (sender === 'bot' ? 'justify-start' : 'justify-end');
            bubble.className = 'max-w-xs p-3 rounded-xl ' + 
                (sender === 'bot' ? 'chat-bubble-bot' : 'chat-bubble-user');
            bubble.textContent = message;
            messageWrapper.appendChild(bubble);
            chatBox.appendChild(messageWrapper);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        // Handle user input
        document.getElementById('send-btn').addEventListener('click', handleUserInput);
        document.getElementById('user-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleUserInput();
        });

        function handleUserInput() {
            const input = document.getElementById('user-input');
            const message = input.value.trim();
            if (!message) return;

            addMessage(message, 'user');
            input.value = '';

            // Here you'll add your chatbot logic
            setTimeout(() => {
                addMessage("I received your message: " + message, 'bot');
            }, 1000);
        }
    </script>
</body>
</html>